version: 1.0
runtime: python311

build:
  commands:
    # Ensure we're in the backend directory (works whether App Runner starts from repo root or backend/)
    - if [ -f pyproject.toml ]; then echo "Using backend/ as working directory"; else cd backend; fi
    - pip install --no-cache-dir poetry==1.7.1
    - poetry config virtualenvs.create false
    - poetry install --only main --no-root --no-interaction --no-ansi

run:
  command: if [ -f pyproject.toml ]; then uvicorn jobly.api.main:app --host 0.0.0.0 --port 8000; else cd backend && uvicorn jobly.api.main:app --host 0.0.0.0 --port 8000; fi
  network:
    port: 8000


